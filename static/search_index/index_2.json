{"/teedoc-notes/é¦™æ©™æ´¾/index.html":{"title":"é¦™æ©™æ´¾","content":" title: é¦™æ©™æ´¾ keywords: é¦™æ©™æ´¾ date: 2023 07 19 å…³äºé¦™æ©™æ´¾çš„å­¦ä¹ å†…å®¹"},"/teedoc-notes/é¦™æ©™æ´¾/ä½¿ç”¨dockerå®‰è£…gitea+jenkins.html":{"title":"ä½¿ç”¨dockerå®‰è£…gitea+jenkins","content":"# ä½¿ç”¨dockerå®‰è£…gitea+jenkins å‚è€ƒï¼š[Gitea ä¸ Jenkins çš„é›†æˆå®è·µï¼Œæ‰“é€ ä½ çš„ä¸“å± CI/CD ç³»ç»Ÿ](https://www.cnblogs.com/Gitea/p/jenkins.html) ## æ³¨æ„ ### 1. Jenkinsçš„ç‰ˆæœ¬é—®é¢˜ Jenkinsä¸èƒ½åƒlinuxçš„åŒ…ç®¡ç†å™¨é‚£æ ·è‡ªåŠ¨å¤„ç†å„ç§ç‰ˆæœ¬å†²çªï¼Œå› æ­¤ç¬¬ä¸€æ¬¡å®‰è£…æ’ä»¶æ—¶ä¸å‡ºæ„å¤–ä¸€å®šä¼šå¤±è´¥ã€‚ä½†æ‰‹åŠ¨å¤„ç†å†²çªï¼ˆå†å®˜ç½‘ä¸Šä¾æ¬¡ä¸‹è½½é€‚åˆå½“å‰Jenkinsç‰ˆæœ¬çš„æ’ä»¶ï¼‰å®åœ¨æ˜¯è¿‡äºéº»çƒ¦ï¼Œå› æ­¤é€‰æ‹©æ‰‹åŠ¨å°†Jenkinså‡è‡³æœ€æ–°ç‰ˆï¼Œè¿™æ ·ä¸€èˆ¬èƒ½ç›´æ¥æ»¡è¶³æ‰€æœ‰æ’ä»¶å¯¹Jenkinsçš„ç‰ˆæœ¬è¦æ±‚ã€‚å…·ä½“åšæ³•æ˜¯ä»å®˜ç½‘ä¸‹è½½Jenkinsçš„æœ€æ–°ç‰ˆwaråŒ…ï¼Œè¿è¡Œdockerå®¹å™¨ï¼Œå°†ä¸‹è½½çš„waråŒ…æ›¿æ¢æ‰å®¹å™¨ä¸­çš„`/usr/share/jenkins/jenkins.war`ï¼Œç„¶åå†é‡å¯å®¹å™¨å³å¯ã€‚é‡å¯ä¹‹åï¼Œæ‰€æœ‰æ’ä»¶è‡ªåŠ¨å®‰è£…æˆåŠŸã€‚ > æ›¿æ¢æœ€æ–°ç‰ˆwaråŒ…å‚è€ƒï¼š[Dockeréƒ¨ç½²çš„Jenkinså¦‚ä½•æ›´æ–°ç‰ˆæœ¬å‘¢](https://blog.csdn.net/tomonkey/article/details/106942162) ### 2. Jenkinsç‰ˆæœ¬ç»ˆæè§£å†³æ–¹æ³• å…ˆä¸ŠDocker Hubæœjenkinsï¼Œç„¶åä½¿ç”¨ä»–ä»¬æœ€æ–°ç‰ˆæœ¬çš„tagï¼Œæ³¨æ„ä¸è¦ç”¨é»˜è®¤çš„`latest`ï¼Œé‚£ä¸ªä¸æ˜¯æœ€æ–°ç‰ˆã€‚æ¯”å¦‚ç°åœ¨çš„æœ€æ–°ç‰ˆæ˜¯`jenkins/jenkins:2.414`ã€‚ ä¸è¦å†æ‰‹åŠ¨æ›¿æ¢äº†ï¼Œé‚£æ ·å¤ªéº»çƒ¦äº†ã€‚ ### 3. giteaçš„webhookæ— æ³•è§¦å‘ è¦åœ¨jenkinsçš„ç³»ç»Ÿé…ç½®é‡Œä¸ºGitea Serverå¢åŠ URLåˆ«åï¼Œå…·ä½“å¯ä»¥ç‚¹Alias URLæ—è¾¹çš„é—®å·ã€‚ > å‚è€ƒï¼š[stackoverflow](https://stackoverflow.com/a/68432979/21743075) ~~ä½†å³ä½¿æ˜¯ä½¿ç”¨äº†è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä¹Ÿä¸èƒ½è®©webhookç¨³å®šè§¦å‘ã€‚è‡³å°‘æ˜¯æˆ‘ä½¿ç”¨Gitea Webhookæä¾›çš„å‡äº‹ä»¶æ— æ³•è§¦å‘ã€‚~~çœ‹èµ·æ¥ä¸æ˜¯jenkinsçš„é—®é¢˜ï¼Œå‡äº‹ä»¶çš„ç¡®æ— æ³•è§¦å‘ï¼Œä½†æ¯æ¬¡æäº¤éƒ½èƒ½æ­£å¸¸è§¦å‘æ„å»ºï¼Œè¿™æ ·å°±ç®—æ˜¯è§£å†³äº†é—®é¢˜ã€‚ ### 4. giteaçš„ç‰ˆæœ¬é—®é¢˜ å’Œjenkinsä¸€æ ·ï¼Œé»˜è®¤çš„`latest`æ ‡ç­¾å¹¶ä¸æ˜¯æœ€æ–°ç‰ˆï¼Œä¹Ÿå¾—ä¸ŠDocker Hubæ‰‹åŠ¨æœgiteaå¹¶ç¡®å®šæœ€æ–°ç‰ˆã€‚æ¯”å¦‚ç›®å‰çš„æœ€æ–°ç‰ˆæ˜¯`gitea/gitea:1.20 nightly`ã€‚ å¦å¤–é™„ä¸Šgiteaæ™®é€šç‰ˆå’Œnightlyç‰ˆçš„åŒºåˆ«ï¼š > ä½ å¥½ï¼Œè¿™æ˜¯Bingã€‚æˆ‘å¯ä»¥å¸®ä½ æ‰¾åˆ°ä¸€äº›å…³äºgiteaæ™®é€šç‰ˆå’Œgitea nightlyçš„åŒºåˆ«çš„ä¿¡æ¯ã€‚ğŸ˜Š > æ ¹æ®æˆ‘çš„æœç´¢ç»“æœï¼Œgiteaæ™®é€šç‰ˆæ˜¯æŒ‡giteaçš„æ­£å¼å‘å¸ƒç‰ˆæœ¬ï¼Œå®ƒç»è¿‡äº†å……åˆ†çš„æµ‹è¯•å’ŒéªŒè¯ï¼Œä¿è¯äº†ç¨³å®šæ€§å’Œå®‰å…¨æ€§ã€‚gitea nightlyæ˜¯æŒ‡giteaçš„æ¯æ—¥æ„å»ºç‰ˆæœ¬ï¼Œå®ƒåŒ…å«äº†æœ€æ–°çš„å¼€å‘è¿›å±•å’ŒåŠŸèƒ½ï¼Œä½†å¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯å’Œé—®é¢˜ã€‚ > å¦‚æœä½ æƒ³ä½¿ç”¨giteaçš„æœ€æ–°åŠŸèƒ½å’Œç‰¹æ€§ï¼Œä½ å¯ä»¥é€‰æ‹©gitea nightlyï¼Œä½†ä½ éœ€è¦æ³¨æ„å¤‡ä»½ä½ çš„æ•°æ®å’Œé…ç½®ï¼Œå¹¶ä¸”åŠæ—¶åé¦ˆä»»ä½•é—®é¢˜ã€‚å¦‚æœä½ æƒ³ä½¿ç”¨giteaçš„ç¨³å®šç‰ˆæœ¬ï¼Œä½ å¯ä»¥é€‰æ‹©giteaæ™®é€šç‰ˆï¼Œä½†ä½ å¯èƒ½æ— æ³•äº«å—åˆ°ä¸€äº›æ–°çš„æ”¹è¿›å’Œä¼˜åŒ–ã€‚ > ä½ å¯ä»¥åœ¨è¿™é‡Œä¸‹è½½giteaçš„ä¸åŒç‰ˆæœ¬ï¼š<https://dl.gitea.io/gitea/> > å¸Œæœ›è¿™äº›ä¿¡æ¯å¯¹ä½ æœ‰å¸®åŠ©ã€‚å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜ï¼Œæ¬¢è¿ç»§ç»­æé—®ã€‚ğŸ˜Š ### 5. æ–°ç‰ˆgiteaçš„WebhookæŠ¥é”™ webhook.ALLOWED_HOST_LIST ä½¿ç”¨æ–°ç‰ˆï¼ˆ1.20ï¼‰giteaï¼Œåœ¨æµ‹è¯•åˆ°jenkinsçš„webhookæ—¶ï¼Œæ— æ³•æ¨é€ï¼ŒæŠ¥é”™å¦‚ä¸‹ï¼š ~~~text Delivery: Post \"http://jenkins:8080/gitea webhook/post\": dial tcp 172.26.0.2:8080: webhook can only call allowed HTTP servers (check your webhook.ALLOWED_HOST_LIST setting), deny 'jenkins(172.26.0.2:8080)' ~~~ åŸå› æ˜¯giteaæ— æ³•å‘é€postè¯·æ±‚ï¼Œå› ä¸ºæ–°ç‰ˆgiteaé»˜è®¤ç¦ç”¨äº†webhookï¼ˆï¼Ÿï¼Ÿï¼Ÿwhyï¼Ÿï¼Ÿï¼Ÿï¼‰ï¼Œåœ¨`/data/gitea/conf/app.ini`ä¸­åŠ ä¸Šï¼š ~~~text [webhook] ALLOWED_HOST_LIST * ~~~ ä¹‹åé‡å¯å®¹å™¨ï¼ˆ`docker container restart gitea`ï¼‰å³å¯ã€‚ å‚è€ƒï¼š[WebhookæŠ¥é”™ webhook.ALLOWED_HOST_LIST](https://discourse.gitea.io/t/webhook webhook allowed host list setting/4655)"},"/teedoc-notes/é¦™æ©™æ´¾/armbian.html":{"title":"å°†ç³»ç»Ÿæ¢æˆarmbian","content":"# å°†ç³»ç»Ÿæ¢æˆarmbian armbianå¯¹å•æ¿æœºè¿›è¡Œäº†[ç‹¬ç‰¹ä¼˜åŒ–](https://docs.armbian.com/Quick_facts/)ï¼Œå¦‚é’ˆå¯¹SDå¡æ€§èƒ½çš„ä¼˜åŒ–ã€‚ç”šè‡³ç›¸æ¯”å®˜æ–¹ç§»æ¤çš„Ubuntuå’ŒDebianéƒ½è¦æ›´é€‚åˆå•æ¿æœºã€‚"},"/teedoc-notes/é¦™æ©™æ´¾/samba.html":{"title":"samba","content":"# samba ## ä»‹ç» åœ¨debianä¸Šéœ€è¦å®‰è£…åŒ…`smb`å’Œ`smbclient`ï¼Œå‰è€…åŒ…å«ä¸¤ä¸ªæœåŠ¡`smbd`å’Œ`nmbd`ï¼Œåè€…æ˜¯å®¢æˆ·ç«¯ï¼Œç”¨äºæµ‹è¯•ã€‚ å¦‚æœéœ€è¦å°†è¿œç¨‹sambaæœåŠ¡åœ¨fstabä¸­è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼Œè¿˜éœ€è¦å®‰è£…`cifs utils`ã€‚ `smbd`å ç”¨139å’Œ445ç«¯å£ï¼Œ`nmbd`å ç”¨137å’Œ138ç«¯å£ã€‚ ## å¸¸ç”¨å‘½ä»¤ ### `pdbedit` æŸ¥çœ‹sambaä¸­å·²æœ‰çš„ç”¨æˆ· ~~~bash pdbedit L # åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·ï¼ˆç®€ç•¥ï¼‰ pdbedit Lv # åˆ—å‡ºæ‰€æœ‰ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ ~~~ ### `smbpasswd` ç®¡ç†è´¦å· ~~~bash smbpasswd a smb1 # å‘sambaçš„æ•°æ®åº“ä¸­å¢åŠ ç”¨æˆ·smb1 (smb1å¿…é¡»æ˜¯linuxä¸­å·²æœ‰çš„ç”¨æˆ·ï¼Œæœ€å¥½è®¾ç½®/sbin/nologin) smbpasswd x smb1 # ä»sambaæ•°æ®åº“ä¸­åˆ é™¤ç”¨æˆ·smb1 smbpasswd smb1 # ä¿®æ”¹smb1çš„sambaå¯†ç  ~~~ ### `smbstatus` æœåŠ¡å™¨çŠ¶æ€ ~~~bash smbstatus # åˆ—å‡ºsambaæœåŠ¡çš„è¯¦ç»†çŠ¶æ€ ~~~ ### `smbclient` linuxå®¢æˆ·ç«¯ ~~~bash # smbclient éœ€è¦å®‰è£…åŒååŒ…æ‰èƒ½ä½¿ç”¨ smbclient L 192.168.1.103 # è®¿é—®å¯¹åº”ipä¸Šçš„sambaæœåŠ¡ # æ‰§è¡Œåé»˜è®¤ä½¿ç”¨åä¸ºrootçš„sambaç”¨æˆ·ï¼Œä¼šæç¤ºè¾“å…¥å¯†ç  # å¦‚æœä¸è¾“å¯†ç ç›´æ¥å›è½¦ï¼Œå°±æ˜¯åŒ¿å()è®¿é—® smbclient L 192.168.1.103 U smb1%hello # æŒ‡å®šäº†ç”¨æˆ·smb1ï¼Œå¯†ç hello # UNCè·¯å¾„(Universal Naming Convention, é€šç”¨å‘½åè§„èŒƒ), æ ¼å¼å¦‚ï¼š # \\\\sambaserver\\sharename smbclient //192.168.1.103/sharefile U smb1%hello # ä½¿ç”¨UNCè·¯å¾„è®¿é—® ~~~ ### `testparm` æ£€æŸ¥smb.confçš„è¯­æ³•é”™è¯¯ ## å…·ä½“é…ç½® è§`linux\\æ¨¡æ¿é…ç½®æ–‡ä»¶\\smb.conf` ## sambaé…ç½®ä¸­çš„å®å®šä¹‰ %m å®¢æˆ·ç«¯ä¸»æœºçš„NetBIOSå %M å®¢æˆ·ç«¯ä¸»æœºçš„FQDN %H å½“å‰ç”¨æˆ·homeç›®å½•è·¯å¾„ %U å½“å‰ç”¨æˆ·çš„ç”¨æˆ·å %g å½“å‰ç”¨æˆ·æ‰€å±ç»„ %h sambaæœåŠ¡å™¨çš„ä¸»æœºå %L sambaæœåŠ¡å™¨çš„NetBIOSå %I å®¢æˆ·ç«¯ä¸»æœºçš„IP %T å½“å‰æ—¥æœŸå’Œæ—¶é—´ %S å¯ç™»å½•çš„ç”¨æˆ·å ## Windowsç¼“å­˜è´¦å·å¯†ç  ä½¿ç”¨Windowsè®¿é—®äº†linuxä¸Šçš„sambaæœåŠ¡ï¼ŒWindowsä¼šç¼“å­˜è¾“å…¥äº†è´¦å·å’Œå¯†ç ã€‚ å¯ä»¥é€šè¿‡é‡å¯æˆ–æ³¨é”€æ¸…é™¤ç¼“å­˜ã€‚ æˆ–è€…æ‰“å¼€cmdï¼ˆä¸éœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰ï¼Œä½¿ç”¨`net use`å‘½ä»¤æŸ¥çœ‹ç¼“å­˜é¡¹ã€‚ ä½¿ç”¨`net use \\\\192.168.1.103\\share /del`åˆ é™¤ç¼“å­˜é¡¹ã€‚ åˆ é™¤ä¹‹åï¼Œç­‰å¾…ä¸€ä¼šï¼Œå†æ¬¡è®¿é—®ï¼Œä¼šæç¤ºé‡æ–°è¾“å…¥å¯†ç ã€‚"},"/teedoc-notes/é¦™æ©™æ´¾/åŸºç¡€è®¾ç½®.html":{"title":"åŸºç¡€è®¾ç½®","content":"# åŸºç¡€è®¾ç½® ## 1. è®¾ç½®sshè¿æ¥ è·Ÿç€[é˜®ä¸€å³°è€å¸ˆçš„æ•™ç¨‹](https://wangdoc.com/ssh/)èµ°å°±è¡Œäº†ã€‚ ä¸»è¦è®¾ç½®äº†ä»¥ä¸‹å‡ ç‚¹ï¼š 1. ä¸Šä¼ æœ¬åœ°å…¬é’¥åˆ°é¦™æ©™æ´¾ä¸Šï¼Œå®ç°å…å¯†ç ç™»é™†(æ³¨æ„ä¸Šä¼ å…¬é’¥å¯ä»¥ç›´æ¥ä½¿ç”¨`ssh copy id`å‘½ä»¤) 2. ä¿®æ”¹æœ¬åœ°é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨åˆ«åè¿æ¥é¦™æ©™æ´¾ ## 2. å®‰è£…docker æ³¨æ„ä¸è¦ç›´æ¥å®‰è£…æ‰‹å†Œä¸Šæ¨èçš„åŒ…ï¼Œé‚£äº›ä¸æ˜¯armç‰ˆä¸Šçš„ï¼Œè€Œåº”è¯¥å®‰è£…[`docker.io`å’Œ`docker compose`](https://zhuanlan.zhihu.com/p/523871162)ã€‚ å®‰è£…å¥½ä¸¤ä¸ªåŒ…åï¼Œè¿˜è¦è®¾ç½®å›½å†…[é˜¿é‡Œäº‘çš„imageæº](https://cr.console.aliyun.com/cn hangzhou/instances/mirrors)ï¼Œæˆ‘å·²ç»ç”¨ç”µä¿¡æµé‡å¡çš„æ‰‹æœºå·æ³¨å†Œè¿‡äº†ï¼Œç›´æ¥ç™»é™†é˜¿é‡Œäº‘å°±å¯ä»¥çœ‹åˆ°è´¦å·çš„ä¸“å±æºåœ°å€äº†ã€‚ åœ¨é¦™æ©™æ´¾ä¸Šåˆæ¬¡è¿è¡Œ`docker run rm hello world`ä¼šæŠ¥`AppArmor`çš„é”™ï¼Œæ ¹æ®[StackOverflowä¸Šçš„å›ç­”](https://stackoverflow.com/questions/58393628/docker error response from daemon apparmor enabled on system but the docker de)ï¼Œæ˜¯ç³»ç»Ÿæ²¡è£…`AppArmor`ï¼Œè£…ä¸Šåå†é‡å¯dockerå°±å¥½äº†ï¼š`apt install apparmor y` ## 3. åŒæ­¥æ—¶é—´ å®‰è£…`ntpdate`ï¼Œä¿®æ”¹æ—¶åŒºï¼Œè®¾ç½®crontabä»»åŠ¡è®¾ç½®æ—¶é—´åŒæ­¥ï¼š ~~~bash sudo apt install ntpdate y sudo dpkg reconfigure tzdata # å‡ºç°ç•Œé¢ï¼Œå…ˆé€‰æ‹©é€‰æ‹©Asia # ç„¶åå†é€‰æ‹©Shanghai sudo crontab e # åŠ ä¸Šï¼š*/60 * * * * /usr/sbin/ntpdate ntp.sjtu.edu.cn ~~~"}}