{"/teedoc-notes/香橙派/index.html":{"title":"香橙派","content":" title: 香橙派 keywords: 香橙派 date: 2023 07 19 关于香橙派的学习内容"},"/teedoc-notes/香橙派/使用docker安装gitea+jenkins.html":{"title":"使用docker安装gitea+jenkins","content":"# 使用docker安装gitea+jenkins 参考：[Gitea 与 Jenkins 的集成实践，打造你的专属 CI/CD 系统](https://www.cnblogs.com/Gitea/p/jenkins.html) ## 注意 ### 1. Jenkins的版本问题 Jenkins不能像linux的包管理器那样自动处理各种版本冲突，因此第一次安装插件时不出意外一定会失败。但手动处理冲突（再官网上依次下载适合当前Jenkins版本的插件）实在是过于麻烦，因此选择手动将Jenkins升至最新版，这样一般能直接满足所有插件对Jenkins的版本要求。具体做法是从官网下载Jenkins的最新版war包，运行docker容器，将下载的war包替换掉容器中的`/usr/share/jenkins/jenkins.war`，然后再重启容器即可。重启之后，所有插件自动安装成功。 > 替换最新版war包参考：[Docker部署的Jenkins如何更新版本呢](https://blog.csdn.net/tomonkey/article/details/106942162) ### 2. Jenkins版本终极解决方法 先上Docker Hub搜jenkins，然后使用他们最新版本的tag，注意不要用默认的`latest`，那个不是最新版。比如现在的最新版是`jenkins/jenkins:2.414`。 不要再手动替换了，那样太麻烦了。 ### 3. gitea的webhook无法触发 要在jenkins的系统配置里为Gitea Server增加URL别名，具体可以点Alias URL旁边的问号。 > 参考：[stackoverflow](https://stackoverflow.com/a/68432979/21743075) ~~但即使是使用了这种方法，我也不能让webhook稳定触发。至少是我使用Gitea Webhook提供的假事件无法触发。~~看起来不是jenkins的问题，假事件的确无法触发，但每次提交都能正常触发构建，这样就算是解决了问题。 ### 4. gitea的版本问题 和jenkins一样，默认的`latest`标签并不是最新版，也得上Docker Hub手动搜gitea并确定最新版。比如目前的最新版是`gitea/gitea:1.20 nightly`。 另外附上gitea普通版和nightly版的区别： > 你好，这是Bing。我可以帮你找到一些关于gitea普通版和gitea nightly的区别的信息。😊 > 根据我的搜索结果，gitea普通版是指gitea的正式发布版本，它经过了充分的测试和验证，保证了稳定性和安全性。gitea nightly是指gitea的每日构建版本，它包含了最新的开发进展和功能，但可能存在一些错误和问题。 > 如果你想使用gitea的最新功能和特性，你可以选择gitea nightly，但你需要注意备份你的数据和配置，并且及时反馈任何问题。如果你想使用gitea的稳定版本，你可以选择gitea普通版，但你可能无法享受到一些新的改进和优化。 > 你可以在这里下载gitea的不同版本：<https://dl.gitea.io/gitea/> > 希望这些信息对你有帮助。如果你还有其他问题，欢迎继续提问。😊 ### 5. 新版gitea的Webhook报错 webhook.ALLOWED_HOST_LIST 使用新版（1.20）gitea，在测试到jenkins的webhook时，无法推送，报错如下： ~~~text Delivery: Post \"http://jenkins:8080/gitea webhook/post\": dial tcp 172.26.0.2:8080: webhook can only call allowed HTTP servers (check your webhook.ALLOWED_HOST_LIST setting), deny 'jenkins(172.26.0.2:8080)' ~~~ 原因是gitea无法发送post请求，因为新版gitea默认禁用了webhook（？？？why？？？），在`/data/gitea/conf/app.ini`中加上： ~~~text [webhook] ALLOWED_HOST_LIST * ~~~ 之后重启容器（`docker container restart gitea`）即可。 参考：[Webhook报错 webhook.ALLOWED_HOST_LIST](https://discourse.gitea.io/t/webhook webhook allowed host list setting/4655)"},"/teedoc-notes/香橙派/armbian.html":{"title":"将系统换成armbian","content":"# 将系统换成armbian armbian对单板机进行了[独特优化](https://docs.armbian.com/Quick_facts/)，如针对SD卡性能的优化。甚至相比官方移植的Ubuntu和Debian都要更适合单板机。"},"/teedoc-notes/香橙派/samba.html":{"title":"samba","content":"# samba ## 介绍 在debian上需要安装包`smb`和`smbclient`，前者包含两个服务`smbd`和`nmbd`，后者是客户端，用于测试。 如果需要将远程samba服务在fstab中设置开机自动挂载，还需要安装`cifs utils`。 `smbd`占用139和445端口，`nmbd`占用137和138端口。 ## 常用命令 ### `pdbedit` 查看samba中已有的用户 ~~~bash pdbedit L # 列出所有用户（简略） pdbedit Lv # 列出所有用户的详细信息 ~~~ ### `smbpasswd` 管理账号 ~~~bash smbpasswd a smb1 # 向samba的数据库中增加用户smb1 (smb1必须是linux中已有的用户，最好设置/sbin/nologin) smbpasswd x smb1 # 从samba数据库中删除用户smb1 smbpasswd smb1 # 修改smb1的samba密码 ~~~ ### `smbstatus` 服务器状态 ~~~bash smbstatus # 列出samba服务的详细状态 ~~~ ### `smbclient` linux客户端 ~~~bash # smbclient 需要安装同名包才能使用 smbclient L 192.168.1.103 # 访问对应ip上的samba服务 # 执行后默认使用名为root的samba用户，会提示输入密码 # 如果不输密码直接回车，就是匿名()访问 smbclient L 192.168.1.103 U smb1%hello # 指定了用户smb1，密码hello # UNC路径(Universal Naming Convention, 通用命名规范), 格式如： # \\\\sambaserver\\sharename smbclient //192.168.1.103/sharefile U smb1%hello # 使用UNC路径访问 ~~~ ### `testparm` 检查smb.conf的语法错误 ## 具体配置 见`linux\\模板配置文件\\smb.conf` ## samba配置中的宏定义 %m 客户端主机的NetBIOS名 %M 客户端主机的FQDN %H 当前用户home目录路径 %U 当前用户的用户名 %g 当前用户所属组 %h samba服务器的主机名 %L samba服务器的NetBIOS名 %I 客户端主机的IP %T 当前日期和时间 %S 可登录的用户名 ## Windows缓存账号密码 使用Windows访问了linux上的samba服务，Windows会缓存输入了账号和密码。 可以通过重启或注销清除缓存。 或者打开cmd（不需要管理员权限），使用`net use`命令查看缓存项。 使用`net use \\\\192.168.1.103\\share /del`删除缓存项。 删除之后，等待一会，再次访问，会提示重新输入密码。"},"/teedoc-notes/香橙派/基础设置.html":{"title":"基础设置","content":"# 基础设置 ## 1. 设置ssh连接 跟着[阮一峰老师的教程](https://wangdoc.com/ssh/)走就行了。 主要设置了以下几点： 1. 上传本地公钥到香橙派上，实现免密码登陆(注意上传公钥可以直接使用`ssh copy id`命令) 2. 修改本地配置文件，使用别名连接香橙派 ## 2. 安装docker 注意不要直接安装手册上推荐的包，那些不是arm版上的，而应该安装[`docker.io`和`docker compose`](https://zhuanlan.zhihu.com/p/523871162)。 安装好两个包后，还要设置国内[阿里云的image源](https://cr.console.aliyun.com/cn hangzhou/instances/mirrors)，我已经用电信流量卡的手机号注册过了，直接登陆阿里云就可以看到账号的专属源地址了。 在香橙派上初次运行`docker run rm hello world`会报`AppArmor`的错，根据[StackOverflow上的回答](https://stackoverflow.com/questions/58393628/docker error response from daemon apparmor enabled on system but the docker de)，是系统没装`AppArmor`，装上后再重启docker就好了：`apt install apparmor y` ## 3. 同步时间 安装`ntpdate`，修改时区，设置crontab任务设置时间同步： ~~~bash sudo apt install ntpdate y sudo dpkg reconfigure tzdata # 出现界面，先选择选择Asia # 然后再选择Shanghai sudo crontab e # 加上：*/60 * * * * /usr/sbin/ntpdate ntp.sjtu.edu.cn ~~~"}}