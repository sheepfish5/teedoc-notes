{"/teedoc-notes/Linux/index.html":{"title":"Linux","content":" title: Linux keywords: Linux date: 2023 07 19 关于Linux的学习内容"},"/teedoc-notes/Linux/其他/arch里的虚拟机.html":{"title":"arch里的虚拟机","content":"# arch里的虚拟机 arch物理机上使用QEMU开了两台CentOS7的虚拟机, root密码都是1234, 带图形界面的虚拟机普通用户为sheepfish, 另一台不带虚拟机的普通用户为yuyang, 密码都改成了4321. 第三台虚拟机, root密码是1234, 普通用户是sheepfish, 密码是4321 使用左ctrl加左alt能将鼠标从QEMU中释放出来"},"/teedoc-notes/Linux/其他/Termux-Api问题.html":{"title":"Termux-Api问题","content":"# Termux Api问题 在手机的termux里用termux api里的命令全部被挂起，没有输出，命令也不结束： ![图片][def] 输入`termux sms list`命令，没有效果。 网上也没人给出有效的解决方法。 这个东西已经耗费了我太多太多时间，我尝试了很久，还是没能成功。 这样下去不是办法，我决定从此放弃termux api，不再过问！ [def]: /images/Screenshot_2022_1113_154225.jpg"},"/teedoc-notes/Linux/其他/安装QEMU虚拟机软件后没有网桥.html":{"title":"创建网桥","content":"# 创建网桥 ## 使用`brctl utils`包 需要安装`bridge utils`包，并手动创建一个网桥： ~~~shell brctl addbr \"bridgename\" ~~~ 比如添加一个名为br0的网桥： ~~~shell brctl addbr br0 ~~~ 命令需要root权限。 创建的网桥关机后就自动没了，因此每次启动都需要手动重新创建这个网桥。 参考：[linux基金会官网](https://wiki.linuxfoundation.org/networking/bridge) ## 使用`iprout2`包 `brctl utils2`包已经被弃用了, 现在应该用`iproute2`包. ~~~shell ip link add name br0 type bridge # 创建一个名为br0的网桥 ip link set dev br0 up # 激活网桥 ~~~ 详细信息: [arch wiki Network bridge](https://wiki.archlinux.org/title/Network_bridge) 但现在还无法设置我的物理无限网卡和这个网桥关联, 只能之后有空再试了 TODO 找出能让物理网卡与网桥关联的方法, 使虚拟机联网."},"/teedoc-notes/Linux/基础知识/CPU负载表示.html":{"title":"CPU负载表示","content":"# CPU负载表示 在`top`命令中，会见到`load average: 1.49, 1.13, 1.04`这样表示CPU负载的。 鸟哥的教程中是这样解释的： > CPU 在单一时间点所负责的工作数量。不是 CPU 的使用率喔! 举例来说,如果我有一只程序他需要一直使用 CPU 的运算功能,那么此时 CPU 的使用率可能到达 100% , 但是 CPU 的工作负载则是趋近于“ 1 ”,因为 CPU 仅负责一个工作嘛!如果同时执行这样的程序两支呢? CPU 的使用率还是 100% ,但是工作负载则变成 2 了!了解乎? 也可以使用`uptime`查看CPU负载，输出和`top`的第一行完全一样。"},"/teedoc-notes/Linux/基础知识/特殊文件权限SUID, SGID, SBIT总结.html":{"title":"特殊文件权限SUID, SGID, SBIT总结","content":"# 特殊文件权限SUID, SGID, SBIT总结 SUID 只可用于二进制可执行文件. SUID文件权限如` rwsrwxrwx`. 当其他人执行了SUID文件, 在执行过程中, 该进程拥有文件所有者的权限. 比如passwd是一个SUID文件, 所有者是root, 普通用户执行passwd时, passwd拥有root权限. SGID 可用于目录或二进制可执行文件. SGID文件(目录)权限如`drwxrwsrwx`. 对于SGID目录, 用户在该目录下的有效群组将会变为该目录的群组, 创建在该目录下的所有文件或目录的群组默认与该目录相同. 比如有一个SGID的common目录, 其群组为root, 用户sheepfish在其中创建了一个test目录, 那么test目录的群组默认为root. 但是之后可以使用`chgrp`命令改变test的群组 对于SGID二进制可执行文件, 类似与SUID, 用户执行时, 进程拥有和文件相同的群组. 比如locate是一个SGID指令, 群组为slocate, 用户sheepfish执行locate时, locate可以读取只有slocate用户才有读权限的文件. SBIT 只对目录有效 SBIT目录权限如`drwxrwxrwt` 用户A在一个SBIT目录下创建了一个文件test, 那么, 该文件只有A和root才能删除, 即使用户B有该目录的W权限, B也不能删除test文件. /tmp目录就是一个SBIT目录"},"/teedoc-notes/Linux/日常使用/Konsole字体问题.html":{"title":"","content":"![](/images/字体混乱.png) 之前一直有这种字体问题。 后来在telegram上求助，@Senaruk大佬回复说调fontconfig，参考下面的连接： <https://github.com/liolok/dotfiles/blob/master/.config/fontconfig/fonts.conf> 我把链接中的内容复制到用户字体配置文件~/.config/fontconfig/fonts.conf后，再使用 `fc cache` 命令重建 Fontconfig 的配置，就解决了问题 ![](/images/Pasted%20image%2020230217143054.png) 之后有时间再细看字体配置： <https://wiki.archlinuxcn.org/wiki/%E5%AD%97%E4%BD%93%E9%85%8D%E7%BD%AE>"},"/teedoc-notes/Linux/用msmtp发邮件.html":{"title":"用msmtp发邮件","content":"# 用msmtp发邮件 ## 先安装 ~~~bash apt install msmtp ~~~ ## 设置配置文件 配置文件为`~/.msmtprc` 内容实例： ~~~.msmtprc account default auth login host smtp.163.com from hello@163.com user hello@163.com password XXXX tls on tls_certcheck on logfile ~/.msmtp.log ~~~ ## 将邮件内容写在文件里 内容实例 ~~~ To: hello@foxmail.com From: hello@163.com Subject: 邮件主题 邮件内容 ~~~ ## 执行命令 ~~~bash cat /opt/bin/end.mail msmtp read {envelope from,recipients} ~~~"},"/teedoc-notes/Linux/常用工具.html":{"title":"常用工具","content":"# 常用工具 ## 1. `rsync`——和远程服务器传输文件 ~~~bash # 将本地目录rsync同步到远程服务器，走ssh协议 rsync av ~/rsync/ orangepi3lts:/home/orangepi/rsync # 事先已经在ssh的配置文件中设置了orangepi3lts的别名 # 将远程服务器的目录同步到本地 rsync av orangepi3lts:/home/orangepi/rsync/ ~/rsync ~~~ ## 2. `find`查找文件 使用`find`命令按文件名查找文件，只能完全匹配，不能加通配符啥的： ~~~bash find / iname orangepi config # 查找文件orangepe config，不分大小写 ~~~ ## 3. `tmux`在远程服务器新建会话 ~~~bash tmux new s s1 # 创建会话s1 tmux detach # 从会话中离开 tmux ls # 列出所有会话 tmux attach t s1 # 重新进入s1 tmux switch t s1 # 在某个会话中，切换到s1会话 ~~~ ## 4. linux命令行任务管理器`top` `top`是个交互式命令，直接使用`top`命令进入交互界面，具体操作和每个字段的含义可参考[知乎上的介绍](https://zhuanlan.zhihu.com/p/36995443)。 常用按键： `l`, `t`, `m`：依次改变负载信息栏、CPU信息栏、内存信息栏的形式 `V`：以树形展示进程间的父子关系。 `q`：退出 `h`或`?`：查看帮助 ## 5. `free`查看内存使用 ~~~bash free mt # 以MiB为单位查看内存使用情况，包括物理内存和swap ~~~ 具体参考`free help` ## 6. `df`查看磁盘使用 ~~~bash df lh ~~~ ## 7. `lsblk`查看系统所有硬盘情况（不论是否挂载） ~~~bash sudo lsblk ~~~ 具体参考[知乎上的介绍](https://zhuanlan.zhihu.com/p/560173521) ## 8. `netstat`查看网络情况 ~~~bash sudo netstat tunlp ~~~ ## 9. 查看自己的外网ip ~~~bash curl myip.ipip.net ~~~ ## 10. 修复损坏的文件系统 [参考网站][link1] 先取消挂载文件系统，再使用`fsck`修复： ~~~bash sudo umount /dev/sdb1 sudo fsck p /dev/sdb1 ~~~ ## 11. 删除`ssh`指纹 ~~~bash ssh keygen R 192.168.3.26 ~~~ ## 12. 圆周率计算脚本模拟高负载 看看算pi前一万位要多久，命令： ~~~bash time echo \"scale 10000;a(1)*4\" bc l ~~~ ## 13. 查看`UUID` 参考: <https://zhuanlan.zhihu.com/p/62459117> ~~~bash blkid ~~~ [link1]: https://www.bing.com/search?q fsck+修复文件系统&form ANNTH1&refig 1c6ddca2ee784a7389fa390cfd995ed4&sp 1&lq 0&qs LT&pq fsck+&sc 10 5&cvid 1c6ddca2ee784a7389fa390cfd995ed4"},"/teedoc-notes/Linux/基础知识/apt与pkg.html":{"title":"apt与pkg的关系——Bing的回答","content":"# apt与pkg的关系——Bing的回答 你好，这是Bing。我可以帮你解答你的问题。😊 debian系统中的apt和pkg是什么意思？这两个东西有什么不同？ apt和pkg都是debian系统中的包管理工具，它们可以用来安装、卸载、更新和查询软件包。但是它们有一些区别： apt是一个高级的包管理工具，它可以通过仓库（repository）获取软件包资源，解决依赖关系，不能安装本地包。apt是基于dpkg的，它可以使用dpkg来处理单个的deb文件，也可以直接调用dpkg的命令。 dpkg是一个低级的包管理工具，它可以安装本地包，不解决依赖关系，不关心仓库内的软件。dpkg绕过apt包数据库直接对软件包操作，所以你用dpkg安装过的软件包用apt可以再安装一遍，系统不知道之前安装过了，将会覆盖之前dpkg的安装。 pkg是FreeBSD系统的二进制包管理工具，它与dpkg类似，但是它使用的包格式是.txz而不是.deb。pkg也可以从远程仓库获取软件包，并且会处理依赖关系。 总之，apt和pkg都是基于仓库的包管理工具，而dpkg是基于本地文件的包管理工具。apt和pkg都可以处理依赖关系，而dpkg不能。apt和dpkg都使用.deb格式的软件包，而pkg使用.txz格式的软件包。 希望这能回答你的问题。如果你还有其他问题，请继续提问。"},"/teedoc-notes/Linux/基础知识/nfts的默认权限和所有者.html":{"title":"nfts的默认权限和所有者","content":"# nfts的默认权限和所有者 我使用一个ntfs分区来作为我双系统的共享分区，但是在linux下，这个分区里的文件默认所有者和所有组是root:root。 我要改为sheepfish:sheepfish，要在挂载的时候设置相应参数。 如果使用`mount`命令挂载，就设置命令行参数。 我用的是`/etc/fstab`默认挂载，于是在配置文件中按如下方式设置： ~~~Shell Script UUID 8A12645D1264506D /home/sheepfish/media ntfs defaults,nls utf8,umask 000,uid 1000,gid 1000 0 0 ~~~"},"/teedoc-notes/Linux/基础知识/RAID1.html":{"title":"关于RAID1的镜像模式","content":"# 关于RAID1的镜像模式 老师上课时讲的不是真正的镜像模式, 而是RAID1+0 真正的镜像模式应该是: 有n个硬盘, 实际存储的内容只占一个硬盘, 其他的n 1个硬盘都是这个硬盘的镜像, 也就是说有n 1份冗余. 而RAID1就是采用这种镜像模式. > 参考[raid.wiki.kernel.org](https://raid.wiki.kernel.org/index.php/What_is_RAID_and_why_should_you_want_it%3F#RAID1.2FMirror_Mode): > Two or more disks are combined into one volume. Reads/writes are still broken into blocks, but ALL blocks are copied to ALL disks in the volume. > This is the first mode which actually has redundancy. This mode maintains an exact copy of the information on one disk across all the other disks. If any disk fails in the volume (or all disks but 1), the data is still available with no performance degradation. > The size of the volume will be the size of one of the disks in the volume. If one disk is smaller than another, your volume will be the size of the smallest disk. 翻译: 两个或多个磁盘组合成一个卷。读取/写入仍然被分为块，但所有块都被复制到卷中的所有磁盘。 这是第一种实际具有冗余的模式。此模式维护一个磁盘上所有其他磁盘上信息的精确副本。如果卷中的任何磁盘（或除1个磁盘以外的所有磁盘）出现故障，则数据仍然可用，性能不会下降。 卷的大小将是卷中某个磁盘的大小。如果一个磁盘比另一个小，那么您的卷将是最小磁盘的大小。 ## 使用mdadm指令在CentOS7上组软件RAID1 我的虚拟机上有4个空闲分区: /dev/vda10, /dev/vda11, /dev/vda12, /dev/vda13, 每个分区大小为1G 使用mdadm指令, 用软件模拟将这4个分区组成RAID1. 创建RAID1, 结果设备为/dev/md0. ~~~shell mdadm create /dev/md0 \\ auto yes \\ level 1 \\ chunk 256K \\ raid devices 4 \\ spare devices 0 \\ /dev/vda{10,11,12,13} ~~~ 查看RAID1设备的信息: ~~~shell mdadm detail /dev/md0 ~~~"},"/teedoc-notes/Linux/日常使用/蓝牙问题.html":{"title":"arch日常使用中的蓝牙连接问题","content":"# arch日常使用中的蓝牙连接问题 总参考: [arch官网: 蓝牙](https://wiki.archlinuxcn.org/wiki/%E8%93%9D%E7%89%99) ## 蓝牙耳机无法配对 安装了蓝牙基础包后, 我的罗技K380蓝牙键盘可以正常配对使用, 但我的两副蓝牙耳机(联想thinkplus LP5和vivo TWS2)不能配对. 安装`pulseaudio bluetooth`包和`pavucontrol`包, 并重启, 再尝试配对, 能成功配对并使用. ## 双系统需要重新配对 在一个系统里配对好了的蓝牙设备, 换成另一个系统就无法连接, 需要重新配对后才行. 尝试了arch官网推荐的[bt dualboot](https://github.com/x2es/bt dualboot), 没有成功. 之后按照arch官网的手动提取Windows里的蓝牙密钥, 再放到arch里, 最后成功了. 大概就是先在arch里配对蓝牙设备, 再到Windows里配对, 再换回arch, 挂载Windows的C盘, 使用`chntpw`从Windows注册表提取密钥, 再将arch里的密钥换成从Windows里提取的, 重启蓝牙和pulseaudio bluetooth, 就可以了. 具体步骤不赘述了, 按照arch官网上的步骤一步一步走就行了."},"/teedoc-notes/Linux/日常使用/KDE程序Calender Reminder占用内存过大.html":{"title":"KDE程序`Calender Reminder`占用内存过大","content":"# KDE程序`Calender Reminder`占用内存过大 这个程序开机就自动占用500MiB到800MiB, 我也不知道这个程序是干什么用的(上网搜了听说是记录各种事件, 也不清楚是真是假), 尝试卸载过Kalender, 这个程序仍然开机自启动. 根据网上的方法, 这和KDE的`Akonadi`系统有关, 具体有什么关系也我也不深究了, 关闭Akonadi可以让Calender Reminder的内存占用缩小至几十MiB. ~~~shell akonadictl stop ~~~ 已经试过把这条命令放在`~/.bash_profile`和`~/.bashrc`里, 都无法做到开机自动关闭Akonadi, 猜测前两个文件运行得比后者更早."},"/teedoc-notes/Linux/日常使用/arch Linux安装过程及遇到的问题.html":{"title":"arch安装过程中遇到的问题","content":"# arch安装过程中遇到的问题 20220905 安装的全过程是看的知乎大佬的图文教程：[2021 Archlinux双系统安装教程（超详细） 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/138951848) 安装工作是很久之前完成的，这篇文章是安装后补写的，因此安装前的各种信息没办法截图记录。 ## 安装前 ### 修改efi分区 我原本的efi分区之后默认的100MiB，但是arch Linux官网上建议大小是300MiB，知乎教程上也建议扩大分区，于是我就安装了DiskGenius打算从C盘分店容量给efi， > 当时执行到这一步的时候我想起来了，电脑刚买回来的时候efi分区和C盘之间应该是有一个“恢复分区”，但我当时不知道那个是干什么的，于是上网找方法把它给删掉了，之后多出来的空间加到C盘去了。 > 如果我当时没动这个恢复分区的话，现在就可以把恢复分区加到efi分区了，就不用动C盘了，也就没有之后这么多麻烦了。 当时DiskGenius提示无法直接在系统里把C盘向后移动，要用PE系统。 于是我找到了B站大佬自制的PE：[下载 – HotPE](https://www.hotpe.top/download) 把PE安装在了SD卡上，进PE，用其自带的DiskGenius将C盘向后移动了一段距离，并把这些距离分到了efi分区中，此时efi分区容量刚好是1GiB。 ### 恢复系统 退出PE，进入原系统，然后就出现问题了： ![图片](../../images/ArchLinux安装过程及遇到的问题1.jpg) 显示错误码0xc0000225。上网搜了这个错误码，看了几篇方法： [Windows 10出现0xc0000225错误代码如何解决？_都叫兽软件 (reneelab.com.cn)](https://www.reneelab.com.cn/m/windows 10 0xc0000225 error.html) [解决Win10开机0xc0000225进不去系统的5个方法！ (abackup.com)](https://www.abackup.com/easybackup tutorials/win10 boot 0xc0000225 cannot enter 6540.html) 试了其中几篇不需要系统启动盘的方法，无效。 之后我又在PE中把efi分区和C盘恢复，退出PE，再次进入原系统，这个时候仍然是蓝屏，不过错误码变成了0xc000000f。同样，也查了这个错误码：[快速修复：出现错误代码0xc000000f怎么解决？ (disktool.cn)](https://www.disktool.cn/content center/your pc needs to be repaired 0xc000000f 666.html) 又这样反复了几次后，感觉这些方法都没什么用，于是打算重装系统。当然，在重装前进PE把C盘中的部分文件保存到了D盘中。 ### 重装系统 这个主要也是看的知乎文章，不过现在找不到那篇文章了。 主要步骤就是制作启动盘和装系统。 #### 制作系统盘 先下载系统镜像文件。我在著名的[msdn, I tell you](https://msdn.itellyou.cn)上下的Windows10镜像，启动盘制作工具用的[Rufus](https://rufus.ie/zh/)。 由于原系统用不了，就直接用的PE就行制作。 但总是进度条没过多久就报错，我一开始还以为是U盘的问题（毕竟这个U盘是高二买的，之后大量读写后已经明显损坏了），还向刘舟禹借了他的U盘，结果还是同样的问题。 反复试了很多次，还上网查了报错码，换了Rufus的好几个版本，还是没用。 一天中午的时候，我想试试家里的Windows7老电脑，结果一试，居然成了！还是用的有无数坏道的老U盘。那么看来应该就是PE无法制作启动盘了。 #### 装系统 在装系统前，试了下之前文章中用启动盘恢复系统的方法，还是无效，这才真正开始装系统了。 直接装，还是没办法装上去，这个时候我心态已经平和了，于是直接扔下不管了。 #### 关联efi分区和C盘 过了几天，心情稳定下来后，再接着想办法解决问题。 根据鸟哥的Linux教程给出的开机流程，我猜测原efi分区是直接用硬盘扇区地址联系到C盘的，而我移动了C盘，efi内记录的仍是原C盘的位置，开机时引导到错误的C盘位置，所以就蓝屏。 如果我能重置efi分区，让它联系到新的C盘，这样应该就能够正确开机。 上网搜了重置efi分区的方法：[如何重新建立EFI引导分区_百度知道 (baidu.com)](https://zhidao.baidu.com/question/653113488423102885/answer/2864708912.html) 查到了百度知道上腾讯电脑管家官方的回答： ![图片](../../images/ArchLinux安装过程及遇到的问题2.png) 跟着这个方法，在PE中cmd用命令： ~~~cmd bcdboot c:\\windows /s o: /f uefi /l zh cn ~~~ > 这个命令是直接抄的回答，当时的盘符现在记不得了。 > 当时根据回答改了盘符。 之后退出PE，重进系统，错误码从0xc0000225变成了0xc000000f，我肯定是看不懂具体什么意思，当时单纯以为成功联系efi分区和C盘了，特别激动，然后赶快再次装系统，这次进入的界面都和之前不一样了。 #### 再次装系统 重装系统其实就是格式化原系统盘，然后装上新的系统。 在格式化系统盘时，又出问题了，连一个分区都识别不到。 再次上网查了： [疑难解答 如何解决安装Windows 11/10时找不到磁盘驱动器 官方支持 ASUS 中国](https://www.asus.com.cn/support/FAQ/1044458#A2) 总之就是英特尔第十一代酷睿加了新特性，导致了找不到磁盘驱动器。 我用的时宏碁电脑，结果在华硕官网上找到了答案。 根据答案在启动盘上下了相关工具，在装系统时用上工具，成功识别到磁盘。 之后的步骤就很简单了。 安装完后又安装各种Windows更新，装各种驱动……最后勉强回到之前系统的状态（不过肯定还是有蛮多不一样的，比如电池策略就只有一个，原来还有一个Acer策略；系统还带了个“移动套餐\"的UWP应用，原来是没有的；新系统安装不了英特尔傲腾软件，第一次成功安装了，但是启用不了，之后连安装都安装不上……其他地方应该也有些不同，但我可能感觉不到） ### 结果 本来打算安装arch Linux的，结果先学会了安装Windows。 不过结果还是OK的，efi分区已经扩大到了1GiB： ![图片](../../images/ArchLinux安装过程及遇到的问题3.png) > C、D盘间还多了个恢复分区 ## 安装时 安装时倒是没出什么太大的问题，直接跟着知乎流程走就OK了。 ## 安装后 安装后主要有几个问题：没有预装的浏览器，没有中文输入法，连电脑自带的扬声器也用不了，用不了蓝牙。 ### 浏览器 原来有个KDE自带的浏览器，不过明显不太好用，之后我自己用命令行装了Firefox，勉强用了一下，还是用不习惯。最后跟着网上的教程装了edge，具体哪篇文章找不到了。 > 即使是Linux的edge也可以登录微软账号同步消息，edge确实特别好用。 ### 中文输入法 看的知乎其他的文章，装了fcitx5。 一开始还用不了汉语输入，后面才发现添加的是“键盘 汉语”，只有添加“Pinyin”或其他比如“Wubi”这样的输入法才能输入汉语。 添加汉语输入法后又发现英语输入法又出问题了：它会显示完整单词（单词补全），即使是在命令行里也会显示，但Windows中，即使是安装输入法前的arch Linux输入英文时也没有这个单词补全： ![图片](../../images/ArchLinux安装过程及遇到的问题4.png) 我不希望输英文也有这个补全功能。但无论我怎么改设置，都去不掉这个英文补全。 之后突然一次重启后，英文补全就没了，我到现在也不知道是什么原因。 ### 电脑自带的扬声器 一开始用不了扬声器，看视频没有声音，插有线耳机也没用。 觉得是声卡的驱动没打上，先是找了很多文章装驱动，但也没有效果。用`aplay l`命令也是显示找不到声卡。 最后看到这篇arch Linux社区上的提问：[SOLVED No Sound card found in fresh Arch installation / Newbie Corner / Arch Linux Forums](https://bbs.archlinux.org/viewtopic.php?id 258594) 装上sof firmware和alsa ucm conf这两个藏得特别深的固件后重启，才成功启用扬声器。 ### 蓝牙 直接看的官网上的[Bluetooth (简体中文) ArchWiki (archlinux.org)](https://wiki.archlinux.org/title/Bluetooth_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)) 可以连上我的罗技K380，但还是连不上我的联想蓝牙耳机，看了csdn上的文章[(18条消息) Failed to connect: org.bluez.Error.Failed_没有B树的博客 CSDN博客](https://blog.csdn.net/qq_34548075/article/details/107062005)后还是没用。其实即使是连K380还是不太顺利。 这个蓝牙问题到现在还没解决。"}}