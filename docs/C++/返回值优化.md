# 返回值优化

对于一个类`Person`，看以下代码：

~~~C++
Person createPerson() {
    Person tmp;
    return tmp;
}
~~~

调用函数获取返回值时，编译器会自动调用`Person`类的拷贝构造函数，创建一个新对象再返回。因此接收到的对象应该是`tmp`的拷贝。

但实际上我使用 VS2022 和 GNU G++ 编译运行示例，结果是直接返回`tmp`对象，同时`tmp`对象在函数结束后并没有被释放。

这是因为编译器默认使用了**返回值**优化。

可以在编译时加上`-fno-elide-constructors`选项关闭返回值优化，这样就会调用拷贝构造函数了。
